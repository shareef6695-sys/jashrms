import { NextRequest } from 'next/server'; import { query } from '@/lib/db'; export async function POST(req:NextRequest){ const {date}=await req.json(); if(!date) return new Response('date required YYYY-MM-DD',{status:400}); const {rows}=await query<any>(`SELECT id FROM shifts WHERE code IN ('RAMD','RAMN')`); const ids=rows.map((r:any)=>r.id); if(ids.length){ await query(`UPDATE shift_assignments SET effective_to=$1 WHERE shift_id = ANY($2) AND (effective_to IS NULL OR effective_to > $1)`,[date,ids]); await query(`UPDATE shifts SET active=false WHERE id = ANY($1)`,[ids]) } return new Response('Ramadan shifts deactivated',{status:200}) }
