import { NextRequest } from 'next/server'; import { cookies } from 'next/headers'; import { requireUser } from '@/lib/auth'; import { query } from '@/lib/db'; export async function POST(req:NextRequest){ const {action,note}=await req.json(); const t=cookies().get('session_token')?.value; const me=await requireUser(t); if(!me) return new Response('Unauthorized',{status:401}); const {rows}=await query<any>(`SELECT employee_id FROM users WHERE id=$1`,[me.user_id]); const empId=rows[0]?.employee_id; if(!empId) return new Response('No employee',{status:400}); await query(`INSERT INTO attendance_logs(employee_id,action,source,note) VALUES($1,$2,'web',$3)`,[empId,action,note||null]); return new Response('OK',{status:200}) }
